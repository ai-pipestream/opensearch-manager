quarkus.application.name=opensearch-manager
quarkus.application.version=@version@

# Container image configuration
quarkus.container-image.registry=ghcr.io
quarkus.container-image.group=ai-pipestream
quarkus.container-image.name=opensearch-manager
quarkus.container-image.tag=latest

# Quarkus Index Dependencies (CRITICAL for ConfigMapping discovery)

# Production port allocation
quarkus.http.port=38103
quarkus.http.host=0.0.0.0
quarkus.grpc.server.use-separate-server=false

# Development overrides
%dev.quarkus.http.port=38103
%dev.quarkus.http.root-path=/opensearch-manager

# Enable standalone devservices since we're using Compose Dev Services and dev services should inform the host/port etc..
%dev.quarkus.datasource.devservices.enabled=true

# Datasource configuration (PostgreSQL)
quarkus.datasource.db-kind=postgresql
quarkus.flyway.migrate-at-start=true
quarkus.datasource.username=${OPENSEARCH_MANAGER_DB_USER:pipeline}
quarkus.datasource.password=${OPENSEARCH_MANAGER_DB_PASSWORD:password}
# jdbc.url: only set for dev/prod; test uses DevServices which provides URL
%dev.quarkus.datasource.jdbc.url=${OPENSEARCH_MANAGER_DB_URL:jdbc:postgresql://localhost:5432/opensearch_manager}
%dev.quarkus.datasource.reactive.url=${OPENSEARCH_MANAGER_DB_REACTIVE_URL:postgresql://localhost:5432/opensearch_manager}
%prod.quarkus.datasource.jdbc.url=${OPENSEARCH_MANAGER_DB_URL:jdbc:postgresql://localhost:5432/opensearch_manager}
%prod.quarkus.datasource.reactive.url=${OPENSEARCH_MANAGER_DB_REACTIVE_URL:postgresql://localhost:5432/opensearch_manager}

# ======================================================================================================================
# Service Registration Configuration
# ======================================================================================================================
pipestream.registration.enabled=true
pipestream.registration.service-name=opensearch-manager
pipestream.registration.description=OpenSearch indexing and search management service
pipestream.registration.type=SERVICE
# Host selection + discovery are provided by pipestream-server defaults.
# Override with SERVICE_REGISTRATION_* or pipestream.server.* if needed.
pipestream.registration.capabilities=opensearch-indexing,search-management,kafka-consumer
pipestream.registration.tags=opensearch,indexing,search,kafka-consumer

quarkus.grpc.server.enable-reflection-service=true

# Logging Configuration
quarkus.log.level=INFO
quarkus.log.category."ai.pipestream".level=INFO
quarkus.log.category."io.vertx.ext.consul".level=WARN
%dev.quarkus.log.console.level=INFO
%dev.quarkus.log.category."io.quarkus.grpc".level=WARN
%dev.quarkus.log.category."io.smallrye.stork".level=WARN

# OpenSearch Configuration
opensearch.hosts=${OPENSEARCH_HOST:localhost}:${OPENSEARCH_PORT:9200}
opensearch.protocol=http
opensearch.username=${OPENSEARCH_USERNAME:}
opensearch.password=${OPENSEARCH_PASSWORD:}

# Schema manager specific configuration
schema.manager.lock.timeout=PT10S

# Kafka Configuration - only set for prod/dev; test lets DevServices provide bootstrap.servers
%prod.kafka.bootstrap.servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9094}
%dev.kafka.bootstrap.servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9094}
kafka.group.id=opensearch-manager

# Kafka Consumers - extension auto-configures deserializers for Protobuf types
mp.messaging.incoming.drive-updates-in.connector=smallrye-kafka
mp.messaging.incoming.drive-updates-in.topic=drive-updates

mp.messaging.incoming.repository-document-events-in.connector=smallrye-kafka
mp.messaging.incoming.repository-document-events-in.topic=repository-events

mp.messaging.incoming.module-updates-in.connector=smallrye-kafka
mp.messaging.incoming.module-updates-in.topic=module-updates

mp.messaging.incoming.pipedoc-updates-in.connector=smallrye-kafka
mp.messaging.incoming.pipedoc-updates-in.topic=pipedoc-updates

mp.messaging.incoming.process-request-updates-in.connector=smallrye-kafka
mp.messaging.incoming.process-request-updates-in.topic=process-request-updates

mp.messaging.incoming.process-response-updates-in.connector=smallrye-kafka
mp.messaging.incoming.process-response-updates-in.topic=process-response-updates

mp.messaging.incoming.graph-updates-in.connector=smallrye-kafka
mp.messaging.incoming.graph-updates-in.topic=graph-updates

# Semantic metadata events - published when ChunkerConfig, EmbeddingModelConfig, or IndexEmbeddingBinding change
mp.messaging.outgoing.semantic-metadata-events.connector=smallrye-kafka
mp.messaging.outgoing.semantic-metadata-events.topic=semantic-metadata-events
